<!DOCTYPE html>
<html>
    <head>
        <title>Drawer</title>
        <script src='../common/processing-1.3.6.min.js'></script>
        <script src='../common/CCapture.js'></script>
        <script src='../common/webm-writer-0.2.0.js'></script>
        <script src='../common/download.js'></script>
        <script src='../common/gif.js'></script>
        <script src='../common/tar.js'></script>
        <script src='../common/Whammy.js'></script>
    </head>

    <body>
        <canvas id='sketch' data-processing-sources='Drawer.pde Spawn.pde SpawnCluster.pde Particle.pde'></canvas>
        <button onclick='startRecord();'>Start</button>
        <button onclick='stopRecord();'>Stop</button>
        <button onclick='saveRecord();'>Save</button>
        <button onclick='showHotkeys();'>Hotkeys</button>
        <script type='application/javascript'>
            var processingInstance;
            var capturer;
            var canvas;
            var recording = false;

            window.onload = function() {
                canvas = document.getElementById('sketch');
                setInterval(render, 20);
                showHotkeys();
            }

            function showHotkeys() {
                alert('Hotkeys:\nz -- change symmetry mode\nx -- change particle move mode ("both" recommended)\nc -- change symmetry center mode\nv -- show screen center\nq -- delete last figure\nk -- delete all figures\na -- increase particle delay by 0.001\ns -- decrease particle delay by 0.001\nd -- increase opacity by 1\nf -- decrease opacity by 1\np -- pause update\nspacebar -- hide params');
            }

            function startRecord() {
                if (recording) {
                    return;
                }
                capturer = new CCapture( { format: 'gif', workersPath: '../common/' } );
                capturer.start();
                recording = true;
            }

            function stopRecord() {
                if (!recording) {
                    return;
                }
                capturer.stop();
                recording = false;
            }

            function saveRecord() {
                if (!capturer) {
                    return;
                }
                capturer.save();
            }

            function render() {
                if (!processingInstance) {
                    processingInstance = Processing.getInstanceById('sketch');
                    if (!processingInstance) {
                        return;
                    }
                    processingInstance.noLoop();
                }
                processingInstance.redraw();
                if (recording) {
                    capturer.capture(canvas);
                }
            }
        </script>
    </body>
</html>
